# Story 6.2: 함수 단일 책임화 및 20줄 기준화

## Story Goal

모든 함수가 하나의 명확한 책임만 가지며 20줄 이하를 만족하도록 분해한다. 가드절/조기 반환을 도입하고 불필요한 중첩을 제거해 가독성과 테스트 용이성을 높인다.

## User Story

As a developer, I want small, focused functions so that code is easy to read, test, and change.

## Acceptance Criteria

1. 비즈니스 로직 함수는 20줄 이하(주석·공백 제외), 책임 1개만 수행
2. 복합 함수 분해: 계산/검증/변환/저장/통신 등 단계별 소함수로 분리
3. 제어 흐름 단순화: 가드절/조기 반환, 중첩 2단계 이하, 의미 있는 이름의 변수 활용
4. 공개 API 동작 불변. 기존 테스트 수정 금지(필요 시 내부 전용 함수로 분리하고 신규 테스트 추가)
5. 린트 규칙: `max-lines-per-function: 20`, `complexity` 임계치 설정 및 CI 게이트 적용
6. 전체 테스트/타입/린트 그린. 성능 비퇴행

## Technical Notes

- 분리 기준: 입력 검증 → 핵심 계산 → 변환/직렬화 → 외부 호출/저장
- 네이밍: 동사로 역할 표현(`validate*`, `compute*`, `transform*`, `save*`)
- 테스트: 소함수 단위 테스트 추가, 기존 시나리오 테스트는 변경하지 않음
- 공통 분리: 중복되는 계산/검증 로직은 `src/utils/*`로 이동

## Definition of Done

- [ ] 규칙 강제 린트 설정/CI 통과
- [ ] 20줄 초과/과복잡 함수 목록 해소(분해/위임 완료)
- [ ] 신규 단위 테스트 추가 및 전체 그린
- [ ] 퍼포먼스·메모리 비퇴행 확인

## Risks & Mitigations

- 과도한 분리로 추적성 저하: 의미 있는 함수명/의존 순서/근접 배치 유지
- 숨은 사이드이펙트 노출: 분리 전/후 회귀 테스트와 타입 강화로 검출
- 성능 영향: 계산 경로에 불필요한 추상화 금지, 마이크로 벤치로 확인

## Testing Requirements

- 함수 길이/복잡도 린트 리포트 0 위반
- 신규 소함수 단위 테스트(성공/에러/경계값)
- 주요 사용자 흐름 회귀 테스트 그린

## Implementation Steps

1. 린트 규칙 추가(`max-lines-per-function`, `complexity`) 및 CI 게이트 설정
2. 리포트 생성 후 상위 N개 초과 함수 우선 분해 계획 수립
3. 분해/위임 및 유틸 추출, 테스트 추가(기존 테스트는 유지)
4. 성능/메모리 확인 및 문서 갱신


