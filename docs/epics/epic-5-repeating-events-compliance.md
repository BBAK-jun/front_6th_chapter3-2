### Epic 5: 반복 일정 요구사항 적합성 개선

#### 배경
반복 일정 기능은 기본적인 생성/표시/삭제 흐름을 제공하지만, 아래 필수 요구사항 중 일부가 미충족 또는 부분 충족으로 확인되었습니다. 본 에픽은 요구사항을 완전 충족하도록 기능/테스트를 보완합니다.

#### 목표
- 반복 유형/규칙의 엣지 케이스(31일, 윤년 2/29)를 명확히 준수
- 종료일 정책(특정 날짜까지, 예제 상 최대 2025-10-30) 정립 및 적용
- 반복 일정 단일 수정 시 자동 단일화 처리 및 표시(아이콘 제거) 정합성 확보
- 관련 단위/통합/회귀 테스트 보강

#### 범위 (In Scope)
- `monthly/yearly` 반복 생성 규칙 보정
- `endDate` 미지정 시 생성 상한 정책 적용(예제 기준 2025-10-30 캡)
- 단일 수정(single) 선택 시 해당 인스턴스의 반복 속성 제거(`repeat.type = 'none'`)
- UI/저장 로직과 캘린더 표시 로직의 일관성 확보
- 신규 테스트 케이스 추가(기존 테스트는 수정하지 않음)

#### 제외 (Out of Scope)
- 서버 스키마 변경 없이 현재 API 계약 유지
- 대규모 UI 리디자인 제외

#### 용어 정의
- "단일 수정": 반복 그룹의 특정 인스턴스만 변경하는 수정. 수정 이후 해당 인스턴스는 반복 일정이 아닌 단일 일정이 됨.

---

### 요구사항 및 수용 기준 (Acceptance Criteria)

1) (필수) 반복 유형 선택
- 사용자는 일정 생성/수정 시 `매일/매주/매월/매년` 중 선택할 수 있다.
- 월 반복: 시작일이 31일인 경우, 매달 31일에만 생성한다. 해당 월에 31일이 없으면 그 달은 생성되지 않는다.
- 연 반복: 시작일이 2/29(윤년)인 경우, 2/29에만 생성한다. 비윤년에는 생성되지 않는다.
- 주 반복(요일 선택)은 기존 동작 유지.

2) (필수) 반복 일정 표시
- 반복 일정은 캘린더에서 반복 아이콘으로 구분 표시한다(현행 유지).

3) (필수) 반복 종료
- 종료 조건으로 "특정 날짜까지"를 지정할 수 있다(`repeat.endDate`).
- 종료일이 비어있는 경우에만 예제 특성상 최대 생성 상한은 2025-10-30을 넘지 않는다(시작일 포함 기준). 종료일이 지정된 경우 사용자 지정 종료일까지 생성한다.

4) (필수) 반복 일정 단일 수정
- 반복 일정을 편집 시 "이 일정만 수정"을 선택하면 해당 인스턴스는 단일 일정으로 변경된다(`repeat.type = 'none'`, `repeat.id` 제거 또는 무시).
- 단일화된 일정은 반복 아이콘이 더 이상 표시되지 않는다.

5) (필수) 반복 일정 단일 삭제
- 반복 일정을 삭제할 때 "이 일정만 삭제"를 선택하면 해당 인스턴스만 삭제된다(현행 유지).

---

### 구현 상세 (Technical Notes)

- 반복 날짜 생성 보정
  - 파일: `src/utils/repeatingEventUtils.ts`
  - `calculateRepeatingDates`에서 `monthly`/`yearly`의 다음 날짜 계산 시 "정확히 같은 일자"가 유효한 달/해인 경우에만 포함한다.
    - 월 반복: 시작일의 일(day)을 기준으로 `setMonth` 후, 결과의 day가 동일하지 않으면 해당 회차를 건너뛴다.
    - 연 반복: 시작일이 2/29이고 다음 해가 비윤년인 경우 해당 회차를 건너뛴다.
  - 종료일 캡 적용: 내부적으로 `effectiveEnd = min(userEndDate ?? Infinity, '2025-10-30')`로 비교.

- 단일 수정 시 단일화
  - 파일: `src/App.tsx`
  - 편집 모드에서 `updateScope === 'single'`인 경우 저장 직전에 `repeat: { type: 'none', interval: 1 }`로 강제 세팅(또는 체크박스를 자동 해제) 후 저장.
  - 결과적으로 `EventItem`에서 반복 아이콘이 사라진다(현행 아이콘 로직 재사용).

- 삭제 동작(단일/전체)
  - 현행 구현을 유지. 단일 삭제는 해당 id만, 전체 삭제는 `repeat.id` 그룹 id 전부.

---

### 테스트 전략

- 단위 테스트 (추가)
  - 파일: `src/__tests__/utils/repeatingEventUtils.spec.ts` 등
  - 케이스:
    - 월 반복 31일 시작: 31일이 없는 달은 건너뜀 검증
    - 연 반복 2/29 시작: 비윤년 회차 미생성 검증
    - 종료일 캡: 종료일 미지정 시 2025-10-30을 넘지 않음 검증(종료일 지정 시 캡 적용 안 함)

- 통합 테스트 (추가)
  - 파일: `src/__tests__/integration/*`
  - 케이스:
    - 단일 수정 선택 시 저장 후 해당 인스턴스가 단일 일정이 되어 아이콘이 사라지는지 검증

- 회귀 테스트 (추가)
  - 기존 동작(반복 표시, 단일 삭제, 전체 삭제)이 유지되는지 보장

- 테스트 정책
  - 기존 테스트는 수정하지 않고, 신규 테스트를 추가한다.

---

### 마이그레이션/데이터 영향
- 기존 이벤트 데이터 형식 변경 없음. 반복 생성/저장 로직 보정에 국한.

### 성능/안정성
- 종료일 캡 및 월/연 반복 보정은 반복 계산 루프 내 조건 분기만 추가하므로 영향 경미.

### 완료 정의 (Definition of Done)
- 모든 Acceptance Criteria 충족
- 신규/수정 코드에 대한 테스트 추가 및 통과
- 캘린더 UI에서 단일 수정 후 아이콘 제거가 확인됨
- 문서 업데이트(`docs/`) 완료

### 변경 파일(예정)
- `src/utils/repeatingEventUtils.ts`
- `src/App.tsx`
- `src/__tests__/utils/repeatingEventUtils.spec.ts` (신규 케이스 추가)
- `src/__tests__/integration/*.spec.ts` (신규 케이스 추가)


